config() {
  # Set default variables
  wifi=false
  SWAP=false
  crypted=false
  GPT=false
  UEFI=false
  mounted=false
  INSTALLED=false
  bootloader=false
  frmt=false
  input=default
  btrfs=true
  vfat=false
  add_repo=false
  enable_bt=false
  enable_f2fs=false
  enable_btrfs=false
  err=false
  manual_part=default
  export reload=false
  colors=true
  screen_h=true
  VM=false
  USB=none
  bluetooth=false
  drm=false
  NVIDIA=false
  GTK3=false
  OnLine=false
  LAPTOP=false
  DM="lightdm"

  # GDL tmp directory
  if [ ! -d /tmp/gdl ]; then
    mkdir /tmp/gdl
  fi

  # Temporary files
  tmp_menu=/tmp/gdl/part.sh
  tmp_list=/tmp/gdl/part.list

  # Generate SSL key
  ssl_key="$(openssl rand -base64 32)"

  # Set term color values
  Green=$'\e[0;32m'
  Yellow=$'\e[0;33m'
  Red=$'\e[0;31m'
  Blue=$'\e[34m'
  ColorOff=$'\e[0m'

  if "${colors}"; then
    # Set default color scheme for installer
    tput civis
    echo -en "\e]P0000000" #darkblack (black)
    echo -en "\e]P1800000" #darkred (maroon)
    echo -en "\e]P200A86B" #darkgreen (jade)
    echo -en "\e]P3DA9100" #darkyellow/brown (harvest gold)
    echo -en "\e]P4082567" #darkblue (sapphire)
    echo -en "\e]P5AB274F" #darkmagenta (amaranth purple)
    echo -en "\e]P63AA8C1" #darkcyan (moonstone)
    echo -en "\e]P7C0C0C0" #darkwhite/lightgrey (silver)
    echo -en "\e]P8555555" #lightblack/darkgrey (Davy's gray)
    echo -en "\e]P9FF2400" #lightred (scarlet)
    echo -en "\e]PA50C878" #lightgreen (emerald)
    echo -en "\e]PBD4AF37" #lightyellow (metallic gold)
    echo -en "\e]PC318CE7" #lightblue (bleu de France)
    echo -en "\e]PDE0115F" #lightmagenta (ruby)
    echo -en "\e]PE7FFFD4" #lightcyan (aquamarine)
    echo -en "\e]PFE5E4E2" #lightwhite (platinum)
    setterm -foreground yellow -store
    tput cnorm
  else
    mv /root/.dialogrc /root/.dialogrc-disabled
  fi

  # Packages to install regardless of desktop environment
  default_packages="acpi alsa-utils base-devel bash bash-completion btrfs-progs
    bzip2 coreutils cpupower cups cups-pdf dhcpcd dialog dosfstools e2fsprogs
    file filesystem findutils gawk gcc-libs gettext git git-lfs glibc grep grub
    gufw gvfs gvfs-mtp gvfs-smb gzip inetutils iproute2 iputils lib32-vkd3d
    licenses linux linux-firmware linux-headers lvm2 man-db man-pages neofetch
    networkmanager network-manager-applet ntfs-3g pacman pacman-contrib
    pavucontrol pciutils procps-ng psmisc pulseaudio pulseaudio-alsa sed shadow
    sudo systemd systemd-sysvcompat tar texinfo tree ttf-dejavu ufw unzip
    util-linux vim vkd3d wget xdg-user-dirs xorg-apps xorg-server xorg-xinit
    xterm xz "

  # Additional packages to install after the base install, esp. AUR software
  additional_packages="breeze-amber-cursor-theme gamemode matcha-gtk-theme
    surfn-icons-git xcursor-breeze "

  # Codecs
  multimedia_codecs="gst-plugins-base gst-plugins-good gst-plugins-bad
    gst-plugins-ugly ffmpegthumbnailer gst-libav "

  # Lutris/Wine: https://github.com/lutris/docs/blob/master/WineDependencies.md
  lutris_and_wine_packages="wine-staging giflib lib32-giflib libpng lib32-libpng
    libldap lib32-libldap gnutls lib32-gnutls mpg123 lib32-mpg123 openal
    lib32-openal v4l-utils lib32-v4l-utils libpulse lib32-libpulse libgpg-error
    lib32-libgpg-error alsa-plugins lib32-alsa-plugins alsa-lib lib32-alsa-lib
    libjpeg-turbo lib32-libjpeg-turbo sqlite lib32-sqlite libxcomposite
    lib32-libxcomposite libxinerama lib32-libxinerama libgcrypt lib32-libgcrypt
    ncurses lib32-ncurses opencl-icd-loader lib32-opencl-icd-loader libxslt
    lib32-libxslt libva lib32-libva gtk3 lib32-gtk3 gst-plugins-base-libs
    lib32-gst-plugins-base-libs vulkan-icd-loader lib32-vulkan-icd-loader
    wine-gecko wine-mono winetricks samba sdl lib32-sdl fluidsynth
    lib32-fluidsynth libva-vdpau-driver lib32-libva-vdpau-driver
    libcanberra-pulse lib32-libcanberra-pulse "

  # Check terminal line height
  if [ "$(tput lines)" -lt 25 ]; then
    screen_h=false
  fi

  # Check for USB device(s)
  if (lsblk | grep "run" | grep -o "sd." &>/dev/null); then
    USB="$(lsblk | grep "run" | grep -o "sd.")"
  fi

  # Check for bluetooth device
  if (dmesg | grep -i "blue" &>/dev/null); then
    bluetooth=true
  fi

  # List of time zones
  zonelist="$(find /usr/share/zoneinfo -maxdepth 1 | sed -n -e 's!^.*/!!p' | grep -v "posix\|right\|zoneinfo\|zone.tab\|zone1970.tab\|W-SU\|WET\|posixrules\|MST7MDT\|iso3166.tab\|CST6CDT" | sort | sed 's/$/ -/g')"

  # Full list of locales
  localelist="$(grep -E "^#?[a-z].*UTF-8" /etc/locale.gen | sed 's/#//' | awk '{print $1" -"}')"

  # Full list of keymaps
  key_maps="$(find /usr/share/kbd/keymaps -type f | sed -n -e 's!^.*/!!p' | grep ".map.gz" | sed 's/.map.gz//g' | sed 's/$/ -/g' | sort)"

  # List of default mount points for manual partitioning
  points_orig=$(echo -e "/boot   boot-mountpoint>\n/home   home-mountpoint>\n/opt   opt-mountpoint>\n/srv   srv-mountpoint>\n/usr    usr-mountpoint>\n/var    var-mountpoint>")

  # Check for laptop battery
  if [ -d /sys/class/power_supply/BAT* ]; then
    LAPTOP=true
  fi

  # Check for Wi-Fi network
  wifi_network=$(ip addr | grep "wlp\|wlo\|wlan" | awk '{print $2}' | sed 's/://' | head -n 1)
  if [ -n "${wifi_network}" ]; then
    wifi=true
  fi

  # Check for VM
  case "$(systemd-detect-virt)" in
  oracle)
    virt="vbox"
    VM=true
    ;;
  vmware)
    virt="vmware"
    VM=true
    ;;
  qemu)
    virt="qemu"
    VM=true
    ;;
  kvm)
    virt="kvm"
    VM=true
    ;;
  microsoft)
    virt="hyper-v"
    VM=true
    ;;
  xen)
    virt="xen"
    VM=true
    ;;
  esac

  # Check microcodes
  if grep -q 'AuthenticAMD' /proc/cpuinfo; then
    UCODE="amd-ucode"
  elif grep -q 'GenuineIntel' /proc/cpuinfo; then
    UCODE="intel-ucode"
  fi

  # Check VGA
  if ! "${VM}"; then
    if (lspci | grep VGA | grep "NVIDIA\|nVidia" &>/dev/null); then
      NVIDIA=true default_GPU="xf86-video-nouveau"
      chipset="Nvidia"
    elif (lspci | grep VGA | grep "ATI\|AMD" &>/dev/null); then
      default_GPU="xf86-video-ati"
      chipset="AMD/ATI"
    elif (lspci | grep VGA | grep "Intel" &>/dev/null); then
      default_GPU="xf86-video-intel"
      chipset="Intel"
    else
      default_GPU="xf86-video-vesa"
      chipset="Unknown"
    fi
  fi
}

# Source all variables
config
